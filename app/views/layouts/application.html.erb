<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Hotel Constantino" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%#= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRUIfuaw/FeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="app-shell d-flex flex-column min-vh-100 <%= content_for?(:body_class) ? yield(:body_class) : "" %>">
    <header class="hc-navbar-backdrop" data-controller="menu" data-menu-target="header">
      <div class="container hc-navbar">
        <div class="d-flex align-items-center gap-3">
          <span class="hc-navbar-tag">Hotel Constantino</span>
          <%= link_to home_path, class: "hc-navbar-brand" do %>
            <span>Plataforma Premium</span>
          <% end %>
        </div>

        <nav class="hc-nav-links">
          <% if user_signed_in? %>
            <% if current_user.admin? %>
              <%= link_to "Dashboard", authenticated_root_path, class: "hc-nav-link #{current_page?(authenticated_root_path) ? "active" : ""}" %>
              <%= link_to "Hotéis", hotels_path, class: "hc-nav-link #{controller_name == "hotels" ? "active" : ""}" %>
              <%= link_to "Hóspedes", hospedes_path, class: "hc-nav-link #{controller_name == "hospedes" ? "active" : ""}" %>
              <%= link_to "Reservas", reservas_path, class: "hc-nav-link #{controller_name == "reservas" ? "active" : ""}" %>
            <% elsif current_user.hospede_record.present? %>
              <%= link_to "Minhas reservas", guest_reservas_path, class: "hc-nav-link #{controller_name == "reservas" ? "active" : ""}" %>
            <% end %>
          <% else %>
            <%= link_to "Início", home_path, class: "hc-nav-link #{current_page?(home_path) ? "active" : ""}" %>
            <%= link_to "Hotéis", hotels_path, class: "hc-nav-link #{controller_name == "hotels" ? "active" : ""}" %>
            <%= link_to "Contato", "mailto:reservas@hotelconstantino.com", class: "hc-nav-link" %>
          <% end %>
        </nav>

        <div class="hc-nav-actions">
          <% if user_signed_in? %>
            <% persona_label, persona_class = if current_user.admin?
              ["Equipe","user-persona-badge--staff"]
            elsif current_user.hospede_record.present?
              ["Hóspede","user-persona-badge--guest"]
            else
              ["Usuário","user-persona-badge--generic"]
            end %>
            <span class="user-persona-badge <%= persona_class %> d-none d-lg-inline-flex"><%= persona_label %></span>
            <span class="text-muted d-none d-lg-inline">Olá, <%= current_user.email %></span>
            <%= link_to "Sair", destroy_user_session_path, data: { turbo_method: :delete }, class: "btn btn-outline-secondary" %>
          <% else %>
            <%= link_to "Entrar", new_user_session_path, class: "btn btn-outline-secondary" %>
            <%= link_to "Criar conta", new_user_registration_path, class: "btn btn-gradient" %>
          <% end %>
          <button type="button" class="hc-hamburger" data-action="click->menu#toggle" aria-label="Abrir menu" aria-expanded="false" data-menu-target="hamburger">
            <span></span>
            <span></span>
            <span></span>
          </button>
        </div>
      </div>
    </header>

    <div class="hc-drawer-backdrop" data-menu-target="backdrop" data-action="click->menu#toggle">
      <div class="hc-drawer" data-menu-target="drawer">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <span class="hc-navbar-tag">Hotel Constantino</span>
          <button type="button" class="hc-hamburger is-open" data-action="click->menu#toggle" aria-label="Fechar menu">
            <span></span>
            <span></span>
            <span></span>
          </button>
        </div>
        <% if user_signed_in? %>
          <% if current_user.admin? %>
            <%= link_to "Dashboard", authenticated_root_path, class: "hc-nav-link d-block" %>
            <%= link_to "Hotéis", hotels_path, class: "hc-nav-link d-block" %>
            <%= link_to "Hóspedes", hospedes_path, class: "hc-nav-link d-block" %>
            <%= link_to "Reservas", reservas_path, class: "hc-nav-link d-block" %>
          <% elsif current_user.hospede_record.present? %>
            <%= link_to "Minhas reservas", guest_reservas_path, class: "hc-nav-link d-block" %>
          <% end %>
          <hr class="opacity-25">
          <%= link_to "Sair", destroy_user_session_path, data: { turbo_method: :delete }, class: "btn btn-outline-secondary" %>
        <% else %>
          <%= link_to "Início", home_path, class: "hc-nav-link d-block" %>
          <%= link_to "Hotéis", hotels_path, class: "hc-nav-link d-block" %>
          <%= link_to "Contato", "mailto:reservas@hotelconstantino.com", class: "hc-nav-link d-block" %>
          <hr class="opacity-25">
          <%= link_to "Entrar", new_user_session_path, class: "btn btn-outline-secondary mb-2" %>
          <%= link_to "Criar conta", new_user_registration_path, class: "btn btn-gradient" %>
        <% end %>
      </div>
    </div>

    <main class="flex-grow-1 py-4">
      <div class="container">
        <% flash.each do |key, message| %>
          <% alert_class = case key.to_sym
            when :notice, :success then "flash-banner--success"
            when :alert, :error then "flash-banner--danger"
            when :warning then "flash-banner--warning"
            else "flash-banner--info"
          end %>
          <div class="toast-glow flash-banner p-3 mb-3 <%= alert_class %>">
            <div class="d-flex justify-content-between align-items-center">
              <span><%= message %></span>
              <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Fechar"></button>
            </div>
          </div>
        <% end %>
      </div>

      <% if content_for?(:full_width) %>
        <%= yield :full_width %>
      <% else %>
        <div class="container">
          <%= yield %>
        </div>
      <% end %>
    </main>

    <footer class="py-4 mt-auto">
      <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center gap-2">
        <span>&copy; <%= Time.current.year %> Hotel Constantino. Todos os direitos reservados.</span>
        <div class="d-flex align-items-center gap-3">
          <a href="mailto:contato@hotelconstantino.com" class="text-muted text-decoration-none">Contato</a>
          <a href="#" class="text-muted text-decoration-none">Termos</a>
        </div>
      </div>
    </footer>
  </body>
</html>
