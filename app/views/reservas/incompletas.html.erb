<% content_for :title, "Reservas pendentes" %>

<div class="page-header">
  <div class="stack-sm">
    <span class="page-eyebrow"><i class="bi bi-kanban"></i> Painel CRM</span>
    <h1 class="page-header__title">Reservas em acompanhamento</h1>
    <p class="page-header__subtitle">Acompanhe quem iniciou o processo de reserva e ainda precisa de validação ou confirmação.</p>
  </div>
  <div class="page-actions">
    <%= link_to "Voltar ao painel", dashboard_path, class: "btn btn-outline-secondary" %>
  </div>
</div>

<div class="stack-lg">
  <div class="surface-card surface-card--compact stack-md table-card" id="verificacao">
    <div class="d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center gap-3">
      <div>
        <h2 class="h5 mb-1">Precisa verificar telefone</h2>
        <p class="text-muted mb-0">Hóspedes que iniciaram a reserva, mas ainda não validaram o telefone no ambiente demo.</p>
      </div>
      <span class="badge bg-warning-subtle text-warning"><%= @reservas_sem_verificacao.size %> pendente(s)</span>
    </div>

    <% if @reservas_sem_verificacao.any? %>
      <div class="table-card__body px-0">
        <div class="table-responsive">
          <table class="table align-middle mb-0">
            <thead>
              <tr>
                <th>Hóspede</th>
                <th>Telefone</th>
                <th>Hotel</th>
                <th>Criada em</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <% @reservas_sem_verificacao.each do |reserva| %>
                <tr>
                  <td>
                    <div class="d-flex align-items-center gap-2">
                      <div class="hc-avatar"><%= reserva.hospede.nome.first.upcase %></div>
                      <div>
                        <div class="fw-semibold"><%= reserva.hospede.nome %></div>
                        <div class="text-muted small"><%= reserva.hospede.email %></div>
                      </div>
                    </div>
                  </td>
                  <td><%= reserva.hospede.telefone %></td>
                  <td><%= reserva.hotel.nome %></td>
                  <td><%= l(reserva.created_at, format: :short) %></td>
                  <td class="text-end">
                    <%= link_to "Ver hóspede", hospede_path(reserva.hospede), class: "btn btn-sm btn-outline-secondary" %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    <% else %>
      <div class="empty-state mb-0">
        <div class="empty-state__icon"><i class="bi bi-check-circle"></i></div>
        <p class="mb-0">Nenhuma pendência de verificação de telefone no momento.</p>
      </div>
    <% end %>
  </div>

  <div class="surface-card surface-card--compact stack-md table-card" id="confirmar">
    <div class="d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center gap-3">
      <div>
        <h2 class="h5 mb-1">Prontas para confirmar</h2>
        <p class="text-muted mb-0">Reservas com telefone validado aguardando apenas a confirmação final da equipe.</p>
      </div>
      <span class="badge bg-info-subtle text-info"><%= @reservas_prontas.size %> aguardando ação</span>
    </div>

    <% if @reservas_prontas.any? %>
      <div class="table-card__body px-0">
        <div class="table-responsive">
          <table class="table align-middle mb-0">
            <thead>
              <tr>
                <th>Hóspede</th>
                <th>Hotel</th>
                <th>Check-in</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <% @reservas_prontas.each do |reserva| %>
                <tr>
                  <td>
                    <div class="d-flex align-items-center gap-2">
                      <div class="hc-avatar"><%= reserva.hospede.nome.first.upcase %></div>
                      <div>
                        <div class="fw-semibold"><%= reserva.hospede.nome %></div>
                        <div class="text-muted small">Telefone verificado ás <%= l(reserva.hospede.phone_verified_at, format: :short) %></div>
                      </div>
                    </div>
                  </td>
                  <td><%= reserva.hotel.nome %></td>
                  <td><%= l(reserva.data_checkin) %></td>
                  <td class="text-end">
                    <%= button_to confirmar_reserva_path(reserva), method: :post, class: "btn btn-sm btn-gradient d-inline-flex align-items-center gap-2" do %>
                      <i class="bi bi-patch-check"></i>
                      Confirmar reserva
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    <% else %>
      <div class="empty-state mb-0">
        <div class="empty-state__icon"><i class="bi bi-emoji-smile"></i></div>
        <p class="mb-0">Sem reservas aguardando confirmação final no momento.</p>
      </div>
    <% end %>
  </div>
</div>
